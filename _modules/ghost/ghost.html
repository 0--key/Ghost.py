
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ghost.ghost &mdash; Ghost.py 0.1a documentation</title>
    
    <link rel="stylesheet" href="../../_static/ghost.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Ghost.py 0.1a documentation" href="../../index.html" />
    <link rel="up" title="ghost" href="../ghost.html" /> 
  </head>
  <body>
  
  


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for ghost.ghost</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">thread</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtNetwork</span> <span class="kn">import</span> <span class="n">QNetworkRequest</span>


<span class="n">default_user_agent</span> <span class="o">=</span> <span class="s">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.2 &quot;</span> <span class="o">+</span>\
    <span class="s">&quot;(KHTML, like Gecko) Chrome/15.0.874.121 Safari/535.2&quot;</span>


<span class="k">class</span> <span class="nc">Logger</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Output colorized logs.&quot;&quot;&quot;</span>
    <span class="n">INFO</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[94m&#39;</span>  <span class="c"># Blue</span>
    <span class="n">SUCCESS</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[92m&#39;</span>  <span class="c"># Green</span>
    <span class="n">WARNING</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[93m&#39;</span>  <span class="c"># Yellow</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[91m&#39;</span>  <span class="c"># Red</span>
    <span class="n">END</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[0m&#39;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;info&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends given message to std ouput.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="nb">type</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="n">message</span><span class="p">,</span>
                <span class="n">Logger</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid log type&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GhostWebPage</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebPage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Overrides QtWebKit.QWebPage in order to intercept some graphical</span>
<span class="sd">    behaviours like alert(), confirm().</span>
<span class="sd">    Also intercepts client side console.log().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">javaScriptConsoleMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints client console message in current output stream.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GhostWebPage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">javaScriptConsoleMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">log_type</span> <span class="o">=</span> <span class="s">&quot;error&quot;</span> <span class="k">if</span> <span class="s">&quot;Error&quot;</span> <span class="ow">in</span> <span class="n">message</span> <span class="k">else</span> <span class="s">&quot;success&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;[Client javascript console]: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">message</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">log_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">javaScriptAlert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;[Client page]: Javascript alert(&#39;</span><span class="si">%s</span><span class="s">&#39;)&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">javaScriptConfirm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;[Client page]: Javascript confirm(&#39;</span><span class="si">%s</span><span class="s">&#39;)&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">)</span>
        <span class="n">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;[Client page]: You must specified a value for confirm&quot;</span>
            <span class="o">%</span> <span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">client_utils_required</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator that checks avabality of Ghost client side utils,</span>
<span class="sd">    injects require javascript file instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_exists</span><span class="p">(</span><span class="s">&#39;GhostUtils&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_js_file</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;utils.js&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">can_load_page</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator that specifies if user can expect page loading from</span>
<span class="sd">    this action. If expect_loading is set to True, ghost will wait</span>
<span class="sd">    for page_loaded event.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;expect_loading&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">expect_loading</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;expect_loading&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expect_loading</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">expect_loading</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_page_loaded</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">HttpRessource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents an HTTP ressource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reply</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">reply</span><span class="o">.</span><span class="n">url</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">http_status</span> <span class="o">=</span> <span class="n">reply</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span>
            <span class="n">QNetworkRequest</span><span class="o">.</span><span class="n">HttpStatusCodeAttribute</span><span class="p">)</span><span class="o">.</span><span class="n">toInt</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">reply</span><span class="o">.</span><span class="n">rawHeaderList</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="nb">unicode</span><span class="p">(</span><span class="n">header</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">reply</span><span class="o">.</span><span class="n">rawHeader</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reply</span> <span class="o">=</span> <span class="n">reply</span>


<div class="viewcode-block" id="Ghost"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost">[docs]</a><span class="k">class</span> <span class="nc">Ghost</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ghost manage a QtApplication executed on its own thread.</span>

<span class="sd">    :param user_agent: The default User-Agent header.</span>
<span class="sd">    :param wait_timeout: Maximum step duration in second.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">command</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_agent</span><span class="o">=</span><span class="n">default_user_agent</span><span class="p">,</span> <span class="n">wait_timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">http_ressources</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">=</span> <span class="n">user_agent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_timeout</span> <span class="o">=</span> <span class="n">wait_timeout</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">thread</span><span class="o">.</span><span class="n">allocate_lock</span><span class="p">()</span>

            <span class="c"># To Qt thread pipe</span>
            <span class="n">Ghost</span><span class="o">.</span><span class="n">pipetoveusz_r</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()</span>
            <span class="n">Ghost</span><span class="o">.</span><span class="n">pipetoveusz_w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c"># Return pipe</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()</span>
            <span class="n">Ghost</span><span class="o">.</span><span class="n">pipefromveusz_r</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">Ghost</span><span class="o">.</span><span class="n">pipefromveusz_w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="n">Ghost</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
            <span class="c"># As there&#39;s no callback on application started,</span>
            <span class="c"># lets sleep for a while...</span>
            <span class="c"># TODO: fix this</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="nd">@client_utils_required</span>
    <span class="nd">@can_load_page</span>
<div class="viewcode-block" id="Ghost.click"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.click">[docs]</a>    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Click the targeted element.</span>

<span class="sd">        :param selector: A CSS3 selector to targeted element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find element to click&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s">&#39;GhostUtils.click(&quot;</span><span class="si">%s</span><span class="s">&quot;);&#39;</span> <span class="o">%</span> <span class="n">selector</span><span class="p">)</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Ghost.content"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.content">[docs]</a>    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns current frame HTML as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_frame</span><span class="o">.</span><span class="n">toHtml</span><span class="p">())</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Ghost.cookies"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.cookies">[docs]</a>    <span class="k">def</span> <span class="nf">cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns all cookies.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookie_jar</span><span class="o">.</span><span class="n">allCookies</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Ghost.delete_cookies"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.delete_cookies">[docs]</a>    <span class="k">def</span> <span class="nf">delete_cookies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes all cookies.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookie_jar</span><span class="o">.</span><span class="n">setAllCookies</span><span class="p">([])</span>
</div>
    <span class="nd">@can_load_page</span>
<div class="viewcode-block" id="Ghost.evaluate"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">,</span> <span class="n">releasable</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates script in page frame.</span>

<span class="sd">        :param script: The script to evaluate.</span>
<span class="sd">        :param releasable: Specifies if callback waiting is needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_frame</span>\
                    <span class="o">.</span><span class="n">evaluateJavaScript</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">script</span><span class="p">),</span>
                <span class="n">releasable</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span>
            <span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_release_last_ressources</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Ghost.evaluate_js_file"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.evaluate_js_file">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_js_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates javascript file at given path in current frame.</span>
<span class="sd">        Raises native IOException in case of invalid file.</span>

<span class="sd">        :param path: The path of the file.</span>
<span class="sd">        :param encoding: The file&#39;s encoding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Ghost.exists"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if element exists for given selector.</span>

<span class="sd">        :param string: The element selector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_frame</span>\
                    <span class="o">.</span><span class="n">findFirstElement</span><span class="p">(</span><span class="n">selector</span><span class="p">),</span> <span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">()</span>
</div>
    <span class="nd">@client_utils_required</span>
<div class="viewcode-block" id="Ghost.fill"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.fill">[docs]</a>    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fills a form with provided values.</span>

<span class="sd">        :param selector: A CSS selector to the target form to fill.</span>
<span class="sd">        :param values: A dict containing the values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">selector</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t find form&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s">&#39;GhostUtils.fill(&quot;</span><span class="si">%s</span><span class="s">&quot;, </span><span class="si">%s</span><span class="s">);&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">values</span><span class="p">))))</span>
</div>
    <span class="nd">@client_utils_required</span>
    <span class="nd">@can_load_page</span>
<div class="viewcode-block" id="Ghost.fire_on"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.fire_on">[docs]</a>    <span class="k">def</span> <span class="nf">fire_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call method on element matching given selector.</span>

<span class="sd">        :param selector: A CSS selector to the target element.</span>
<span class="sd">        :param method: The name of the method to fire.</span>
<span class="sd">        :param expect_loading: Specifies if a page loading is expected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s">&#39;GhostUtils.fireOn(&quot;</span><span class="si">%s</span><span class="s">&quot;, &quot;</span><span class="si">%s</span><span class="s">&quot;);&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Ghost.global_exists"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.global_exists">[docs]</a>    <span class="k">def</span> <span class="nf">global_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if javascript global exists.</span>

<span class="sd">        :param global_name: The name of the global.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s">&#39;!(typeof </span><span class="si">%s</span><span class="s"> === &quot;undefined&quot;);&#39;</span> <span class="o">%</span>
            <span class="n">global_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">toBool</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Ghost.open"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;get&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens a web page.</span>

<span class="sd">        :param address: The ressource URL.</span>
<span class="sd">        :param method: The Http method.</span>
<span class="sd">        :return: Page ressource, All loaded ressources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">open_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span>
            <span class="kn">from</span> <span class="nn">PyQt4.QtNetwork</span> <span class="kn">import</span> <span class="n">QNetworkAccessManager</span><span class="p">,</span> <span class="n">QNetworkRequest</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QByteArray</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">QNetworkAccessManager</span><span class="p">,</span>
                    <span class="s">&quot;</span><span class="si">%s</span><span class="s">Operation&quot;</span> <span class="o">%</span> <span class="n">method</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid http method </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">QNetworkRequest</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="n">address</span><span class="p">))</span>
            <span class="n">request</span><span class="o">.</span><span class="n">setRawHeader</span><span class="p">(</span><span class="s">&quot;User-Agent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_frame</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">open_page</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_page_loaded</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Ghost.wait_for_page_loaded"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.wait_for_page_loaded">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_page_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Waits until page is loaded, assumed that a page as been requested.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span><span class="p">,</span>
            <span class="s">&#39;Unable to load requested page&#39;</span><span class="p">)</span>
        <span class="n">ressources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_release_last_ressources</span><span class="p">()</span>
        <span class="n">page</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">ressource</span> <span class="ow">in</span> <span class="n">ressources</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">ressource</span><span class="o">.</span><span class="n">http_status</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c"># Assumed that current ressource is the first non redirect</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">ressource</span>
        <span class="k">return</span> <span class="n">page</span><span class="p">,</span> <span class="n">ressources</span>
</div>
<div class="viewcode-block" id="Ghost.wait_for_selector"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.wait_for_selector">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Waits until selector match an element on the frame.</span>

<span class="sd">        :param selector: The selector to wait for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">selector</span><span class="p">),</span>
            <span class="s">&#39;Can</span><span class="se">\&#39;</span><span class="s">t find element matching &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">selector</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_release_last_ressources</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Ghost.wait_for_text"><a class="viewcode-back" href="../../index.html#ghost.ghost.Ghost.wait_for_text">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Waits until given text appear on main frame.</span>

<span class="sd">        :param text: The text to wait for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s">&#39;Can</span><span class="se">\&#39;</span><span class="s">t find &quot;</span><span class="si">%s</span><span class="s">&quot; in current frame&#39;</span> <span class="o">%</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_release_last_ressources</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">releasable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the given command in the Qt thread.</span>

<span class="sd">        :param cmd: The command to execute.</span>
<span class="sd">        :param releasable: Specifies if callback waiting is needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">Ghost</span><span class="o">.</span><span class="n">command</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">Ghost</span><span class="o">.</span><span class="n">retval</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="c"># Sends the command to Qt thread</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">releasable</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">pipetoveusz_w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">)</span>
        <span class="c"># Waits for command to be executed</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">pipefromveusz_r</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="n">Ghost</span><span class="o">.</span><span class="n">retval</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">retval</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">retval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">retval</span>

    <span class="k">def</span> <span class="nf">_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Starts a QtApplication on the dedicated thread.</span>

<span class="sd">        :note: Imports have to be done inside thread.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span>
        <span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>
        <span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtNetwork</span>

        <span class="k">class</span> <span class="nc">GhostApp</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">notification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;Notifies application from main thread calls.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
                <span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">Ghost</span><span class="o">.</span><span class="n">pipetoveusz_r</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">assert</span> <span class="n">Ghost</span><span class="o">.</span><span class="n">command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
                <span class="n">cmd</span><span class="p">,</span> <span class="n">releasable</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">Ghost</span><span class="o">.</span><span class="n">command</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Ghost</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="n">cmd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Ghost</span><span class="o">.</span><span class="n">retval</span> <span class="o">=</span> <span class="n">e</span>

                <span class="k">if</span> <span class="n">releasable</span><span class="p">:</span>
                    <span class="n">Ghost</span><span class="o">.</span><span class="n">_release</span><span class="p">()</span>

        <span class="n">app</span> <span class="o">=</span> <span class="n">GhostApp</span><span class="p">([</span><span class="s">&#39;ghost&#39;</span><span class="p">])</span>
        <span class="n">notifier</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSocketNotifier</span><span class="p">(</span><span class="n">Ghost</span><span class="o">.</span><span class="n">pipetoveusz_r</span><span class="p">,</span>
                                       <span class="n">QtCore</span><span class="o">.</span><span class="n">QSocketNotifier</span><span class="o">.</span><span class="n">Read</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">notifier</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;activated(int)&#39;</span><span class="p">),</span>
            <span class="n">app</span><span class="o">.</span><span class="n">notification</span><span class="p">)</span>
        <span class="n">notifier</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">page</span> <span class="o">=</span> <span class="n">GhostWebPage</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">setViewportSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">loadFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_page_loaded</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">loadStarted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_page_load_started</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">networkAccessManager</span><span class="p">()</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_request_ended</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cookie_jar</span> <span class="o">=</span> <span class="n">QtNetwork</span><span class="o">.</span><span class="n">QNetworkCookieJar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">networkAccessManager</span><span class="p">()</span><span class="o">.</span><span class="n">setCookieJar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cookie_jar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span>

        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_release_last_ressources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Releases last loaded ressources.</span>

<span class="sd">        :return: The released ressources.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_ressources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_ressources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">http_ressources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">last_ressources</span>

    <span class="k">def</span> <span class="nf">_page_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called back when page is loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_page_load_started</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called back when page load started.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_release</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Releases the back pipe.&quot;&quot;&quot;</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">Ghost</span><span class="o">.</span><span class="n">pipefromveusz_w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_request_ended</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds an HttpRessource object to http_ressources.</span>

<span class="sd">        :param res: The request result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">http_ressources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HttpRessource</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_wait_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">timeout_message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Waits until condition is True.</span>

<span class="sd">        :param condition: A callable that returns the condition.</span>
<span class="sd">        :param timeout_message: The exception message on timeout.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">started_at</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">condition</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">started_at</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_timeout</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">timeout_message</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <a href="http://github.com/jean-philippe/Ghost.py"><img style="position: fixed; top: 0; right: 0; border: 0;"
    src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  

  

  </body>
</html>